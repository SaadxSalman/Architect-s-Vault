<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Analytics Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/socket.io/socket.io.js"></script>
</head>
<body class="bg-slate-900 text-white min-h-screen p-8">
    <div class="max-w-6xl mx-auto">
        <header class="mb-10">
            <h1 class="text-3xl font-bold text-blue-400">Real-Time Traffic Monitor</h1>
            <p class="text-slate-400">Tracking live visitor metrics via WebSockets & Redis</p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-10">
            <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 shadow-lg">
                <h3 class="text-slate-400 uppercase text-sm font-semibold">Live Visitors</h3>
                <p id="live-users" class="text-5xl font-mono font-bold text-green-400">0</p>
            </div>
            <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 shadow-lg">
                <h3 class="text-slate-400 uppercase text-sm font-semibold">Total Sessions</h3>
                <p id="total-views" class="text-5xl font-mono font-bold text-blue-400">0</p>
            </div>
        </div>

        <div class="bg-slate-800 p-6 rounded-xl border border-slate-700">
            <canvas id="trafficChart" height="100"></canvas>
        </div>
    </div>

    <script>
        const socket = io();
        const ctx = document.getElementById('trafficChart').getContext('2d');
        
        // Initialize Chart.js
        const trafficChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Live Users Over Time',
                    data: [],
                    borderColor: '#60a5fa',
                    backgroundColor: 'rgba(96, 165, 250, 0.2)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                scales: {
                    y: { beginAtZero: true, grid: { color: '#334155' } },
                    x: { grid: { display: false } }
                },
                plugins: { legend: { display: false } }
            }
        });

        // Handle Socket Updates
        socket.on('statsUpdate', (data) => {
            document.getElementById('live-users').innerText = data.liveUsers;
            document.getElementById('total-views').innerText = data.totalViews;

            // Update Chart
            const labels = trafficChart.data.labels;
            const dataset = trafficChart.data.datasets[0].data;

            if (labels.length > 10) {
                labels.shift();
                dataset.shift();
            }

            labels.push(data.timestamp);
            dataset.push(data.liveUsers);
            trafficChart.update();
        });
    </script>
</body>
</html>